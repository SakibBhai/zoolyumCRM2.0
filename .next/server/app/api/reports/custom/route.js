(()=>{var e={};e.id=4195,e.ids=[4195],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{"use strict";e.exports=require("assert")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},11723:e=>{"use strict";e.exports=require("querystring")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},37325:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>P,routeModule:()=>N,serverHooks:()=>C,workAsyncStorage:()=>Y,workUnitAsyncStorage:()=>q});var a={};r.r(a),r.d(a,{DELETE:()=>w,GET:()=>y,POST:()=>j,PUT:()=>f});var s=r(44932),n=r(41913),o=r(96656),i=r(77949),u=r(86745),l=r(26718),c=r(96330),d=r(84133),p=r(8201);let m=new c.PrismaClient,g=d.Ik({name:d.Yj().min(1).max(100),description:d.Yj().max(500).optional(),reportType:d.k5(["financial_summary","project_performance","team_productivity","client_analysis","time_tracking","budget_analysis","revenue_forecast","expense_breakdown","task_completion","custom_query"]),parameters:d.Ik({dateRange:d.Ik({from:d.Yj().datetime(),to:d.Yj().datetime()}),filters:d.Ik({clientIds:d.YO(d.Yj()).optional(),projectIds:d.YO(d.Yj()).optional(),userIds:d.YO(d.Yj()).optional(),categories:d.YO(d.Yj()).optional(),statuses:d.YO(d.Yj()).optional(),priorities:d.YO(d.Yj()).optional(),departments:d.YO(d.Yj()).optional()}).optional(),groupBy:d.YO(d.k5(["client","project","user","category","status","priority","department","date","week","month","quarter","year"])).optional(),metrics:d.YO(d.k5(["revenue","expenses","profit","hours","tasks_completed","budget_utilization","client_satisfaction","team_efficiency","project_progress","cost_per_hour"])).optional(),aggregations:d.YO(d.k5(["sum","avg","count","min","max"])).optional(),sortBy:d.Yj().optional(),sortOrder:d.k5(["asc","desc"]).default("desc"),limit:d.ai().min(1).max(1e3).optional(),includeSubtotals:d.zM().default(!1),includeCharts:d.zM().default(!0),customQuery:d.Ik({tables:d.YO(d.Yj()),fields:d.YO(d.Yj()),joins:d.YO(d.Ik({table:d.Yj(),on:d.Yj(),type:d.k5(["INNER","LEFT","RIGHT","FULL"]).default("LEFT")})).optional(),conditions:d.g1(d.bz()),having:d.g1(d.bz()).optional()}).optional()}),format:d.k5(["json","csv","pdf","excel"]).default("json"),isPublic:d.zM().default(!1),scheduleConfig:d.Ik({enabled:d.zM().default(!1),frequency:d.k5(["daily","weekly","monthly","quarterly"]).optional(),recipients:d.YO(d.Yj().email()).optional(),nextRun:d.Yj().datetime().optional()}).optional()}),h=d.Ik({reportId:d.Yj().optional(),reportType:d.Yj().optional(),parameters:d.g1(d.bz()).optional(),format:d.k5(["json","csv","pdf","excel"]).default("json")});async function y(e){try{let t=await (0,u.getServerSession)(l.Nh);if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),a=r.get("action")||"list";if("list"===a){let e=[{id:"report_1",name:"Monthly Financial Summary",description:"Comprehensive financial overview for the month",reportType:"financial_summary",createdBy:t.user.id,createdAt:new Date().toISOString(),lastRun:new Date().toISOString(),isPublic:!1},{id:"report_2",name:"Team Productivity Report",description:"Analysis of team performance and productivity metrics",reportType:"team_productivity",createdBy:t.user.id,createdAt:new Date().toISOString(),lastRun:new Date().toISOString(),isPublic:!0}];return i.NextResponse.json({reports:e,total:e.length})}if("generate"===a){let e=r.get("reportType"),a=r.get("parameters"),s=r.get("format")||"json";if(!e)return i.NextResponse.json({error:"Report type is required"},{status:400});let n=h.parse({reportType:e,parameters:a?JSON.parse(a):{},format:s}),o=await I(n,t.user.id);if("json"===n.format)return i.NextResponse.json(o);return i.NextResponse.json({error:"Export formats not implemented in this demo"},{status:501})}return i.NextResponse.json({error:"Invalid action parameter"},{status:400})}catch(e){if(e instanceof p.G)return i.NextResponse.json({error:"Validation error",details:e.errors},{status:400});return console.error("Error handling custom reports:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function j(e){try{let t=await (0,u.getServerSession)(l.Nh);if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json(),a=g.parse(r),s={id:`report_${Date.now()}`,...a,createdBy:t.user.id,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),lastRun:null,runCount:0};return i.NextResponse.json(s,{status:201})}catch(e){if(e instanceof p.G)return i.NextResponse.json({error:"Validation error",details:e.errors},{status:400});return console.error("Error saving custom report:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function f(e){try{let t=await (0,u.getServerSession)(l.Nh);if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{id:r,...a}=await e.json();if(!r)return i.NextResponse.json({error:"Report ID is required"},{status:400});let s=g.partial().parse(a),n={id:r,...s,updatedBy:t.user.id,updatedAt:new Date().toISOString()};return i.NextResponse.json(n)}catch(e){if(e instanceof p.G)return i.NextResponse.json({error:"Validation error",details:e.errors},{status:400});return console.error("Error updating custom report:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function w(e){try{let t=await (0,u.getServerSession)(l.Nh);if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url);if(!r.get("id"))return i.NextResponse.json({error:"Report ID is required"},{status:400});return i.NextResponse.json({message:"Report deleted successfully"},{status:200})}catch(e){return console.error("Error deleting custom report:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function I(e,t){let{reportType:r,parameters:a,format:s}=e,{dateRange:n,filters:o,groupBy:i,metrics:u,aggregations:l,sortBy:c,sortOrder:d,limit:p}=a,m=new Date(n?.from||new Date(Date.now()-2592e6)),g=new Date(n?.to||new Date),h={reportType:r,generatedAt:new Date().toISOString(),generatedBy:t,dateRange:{from:m.toISOString(),to:g.toISOString()},parameters:a};switch(r){case"financial_summary":h.data=await x(m,g,o,i);break;case"project_performance":h.data=await v(m,g,o,i);break;case"team_productivity":h.data=await b(m,g,o,i);break;case"client_analysis":h.data=await k(m,g,o,i);break;case"time_tracking":h.data=await E(m,g,o,i);break;case"budget_analysis":h.data=await A(m,g,o,i);break;case"revenue_forecast":h.data=await O(m,g,o,i);break;case"expense_breakdown":h.data=await R(m,g,o,i);break;case"task_completion":h.data=await D(m,g,o,i);break;case"custom_query":if(a.customQuery)h.data=await S(a.customQuery,m,g);else throw Error("Custom query parameters required");break;default:throw Error("Invalid report type")}return h.data?.rows&&Array.isArray(h.data.rows)&&(c&&h.data.rows.sort((e,t)=>{let r=e[c],a=t[c],s=r<a?-1:r>a?1:0;return"desc"===d?-s:s}),p&&(h.data.rows=h.data.rows.slice(0,p))),h}async function x(e,t,r,a){let[s,n,o]=await Promise.all([m.revenue.findMany({where:{date:{gte:e,lte:t},...r?.clientIds?.length&&{clientId:{in:r.clientIds}},...r?.projectIds?.length&&{projectId:{in:r.projectIds}}},include:{client:{select:{id:!0,name:!0}},project:{select:{id:!0,name:!0}}}}),m.expense.findMany({where:{date:{gte:e,lte:t},...r?.userIds?.length&&{userId:{in:r.userIds}},...r?.categories?.length&&{category:{in:r.categories}}},include:{user:{select:{id:!0,name:!0}},project:{select:{id:!0,name:!0}},client:{select:{id:!0,name:!0}}}}),m.budget.findMany({where:{OR:[{startDate:{lte:t},endDate:{gte:e}}],...r?.clientIds?.length&&{clientId:{in:r.clientIds}},...r?.projectIds?.length&&{projectId:{in:r.projectIds}}},include:{project:{select:{id:!0,name:!0}},client:{select:{id:!0,name:!0}}}})]),i=s.reduce((e,t)=>e+t.amount+t.taxAmount,0),u=n.reduce((e,t)=>e+t.amount+t.taxAmount,0),l=o.reduce((e,t)=>e+t.totalAmount,0),c=i-u;return{summary:{totalRevenue:i,totalExpenses:u,profit:c,profitMargin:i>0?c/i*100:0,totalBudget:l,budgetUtilization:l>0?u/l*100:0},revenueByClient:T(s,"client.name","amount"),expensesByCategory:T(n,"category","amount"),monthlyTrends:_(s,n,e,t)}}async function v(e,t,r,a){let s=await m.project.findMany({where:{createdAt:{gte:e,lte:t},...r?.clientIds?.length&&{clientId:{in:r.clientIds}},...r?.statuses?.length&&{status:{in:r.statuses}}},include:{client:{select:{id:!0,name:!0}},tasks:{include:{timeEntries:{select:{hours:!0}}}},revenues:{where:{date:{gte:e,lte:t}}},expenses:{where:{date:{gte:e,lte:t}}},budgets:!0}}),n=s.map(e=>{let t=e.tasks.reduce((e,t)=>e+t.timeEntries.reduce((e,t)=>e+t.hours,0),0),r=e.revenues.reduce((e,t)=>e+t.amount+t.taxAmount,0),a=e.expenses.reduce((e,t)=>e+t.amount+t.taxAmount,0),s=e.budgets.reduce((e,t)=>e+t.totalAmount,0),n=e.tasks.filter(e=>"DONE"===e.status).length,o=e.tasks.length;return{id:e.id,name:e.name,client:e.client?.name,status:e.status,totalHours:t,totalRevenue:r,totalExpenses:a,profit:r-a,totalBudget:s,budgetUtilization:s>0?a/s*100:0,completionRate:o>0?n/o*100:0,totalTasks:o,completedTasks:n,efficiency:t>0?r/t:0}});return{projects:n,summary:{totalProjects:s.length,averageCompletionRate:n.reduce((e,t)=>e+t.completionRate,0)/s.length,totalRevenue:n.reduce((e,t)=>e+t.totalRevenue,0),totalExpenses:n.reduce((e,t)=>e+t.totalExpenses,0),totalHours:n.reduce((e,t)=>e+t.totalHours,0)}}}async function b(e,t,r,a){let s=await m.user.findMany({where:{role:{not:"CLIENT"},isActive:!0,...r?.userIds?.length&&{id:{in:r.userIds}}},include:{assignedTasks:{where:{createdAt:{gte:e,lte:t}},include:{timeEntries:{where:{date:{gte:e,lte:t}}}}},timeEntries:{where:{date:{gte:e,lte:t}}},expenses:{where:{date:{gte:e,lte:t}}}}}),n=s.map(e=>{let t=e.timeEntries.reduce((e,t)=>e+t.hours,0),r=e.assignedTasks.filter(e=>"DONE"===e.status).length,a=e.assignedTasks.length,s=e.expenses.reduce((e,t)=>e+t.amount+t.taxAmount,0);return{id:e.id,name:e.name,email:e.email,role:e.role,totalHours:t,totalTasks:a,completedTasks:r,completionRate:a>0?r/a*100:0,totalExpenses:s,averageTaskTime:r>0?t/r:0,productivity:t>0?r/t:0}});return{teamMembers:n,summary:{totalMembers:s.length,totalHours:n.reduce((e,t)=>e+t.totalHours,0),totalTasks:n.reduce((e,t)=>e+t.totalTasks,0),totalCompletedTasks:n.reduce((e,t)=>e+t.completedTasks,0),averageCompletionRate:n.reduce((e,t)=>e+t.completionRate,0)/s.length,totalExpenses:n.reduce((e,t)=>e+t.totalExpenses,0)}}}async function k(e,t,r,a){let s=await m.client.findMany({where:{...r?.clientIds?.length&&{id:{in:r.clientIds}},...r?.statuses?.length&&{status:{in:r.statuses}}},include:{projects:{include:{tasks:{include:{timeEntries:{where:{date:{gte:e,lte:t}}}}}}},revenues:{where:{date:{gte:e,lte:t}}},expenses:{where:{date:{gte:e,lte:t}}},budgets:!0}}),n=s.map(e=>{let t=e.revenues.reduce((e,t)=>e+t.amount+t.taxAmount,0),r=e.expenses.reduce((e,t)=>e+t.amount+t.taxAmount,0),a=e.budgets.reduce((e,t)=>e+t.totalAmount,0),s=e.projects.length,n=e.projects.filter(e=>"ACTIVE"===e.status).length,o=e.projects.filter(e=>"COMPLETED"===e.status).length,i=e.projects.reduce((e,t)=>e+t.tasks.reduce((e,t)=>e+t.timeEntries.reduce((e,t)=>e+t.hours,0),0),0);return{id:e.id,name:e.name,email:e.email,totalRevenue:t,totalExpenses:r,profit:t-r,totalBudget:a,totalProjects:s,activeProjects:n,completedProjects:o,totalHours:i,revenuePerHour:i>0?t/i:0,profitMargin:t>0?(t-r)/t*100:0}});return{clients:n,summary:{totalClients:s.length,totalRevenue:n.reduce((e,t)=>e+t.totalRevenue,0),totalExpenses:n.reduce((e,t)=>e+t.totalExpenses,0),totalProjects:n.reduce((e,t)=>e+t.totalProjects,0),averageProfitMargin:n.reduce((e,t)=>e+t.profitMargin,0)/s.length}}}async function E(e,t,r,a){let s=await m.timeEntry.findMany({where:{date:{gte:e,lte:t},...r?.userIds?.length&&{userId:{in:r.userIds}},...r?.projectIds?.length&&{task:{projectId:{in:r.projectIds}}}},include:{user:{select:{id:!0,name:!0,role:!0}},task:{select:{id:!0,title:!0,status:!0,priority:!0,project:{select:{id:!0,name:!0}}}}}}),n=s.reduce((e,t)=>{let r=new Date(t.date).toISOString().split("T")[0],a=t.hours||0;return e[r]=(e[r]||0)+a,e},{}),o=T(s,"user.name","hours"),i=T(s,"task.project.name","hours");return{timeEntries:s.map(e=>({id:e.id,date:e.date,hours:e.hours,description:e.description,user:e.user?.name,task:e.task?.title,project:e.task?.project?.name})),summary:{totalHours:s.reduce((e,t)=>e+t.hours,0),totalEntries:s.length,averageHoursPerDay:Object.values(n).reduce((e,t)=>e+t,0)/Object.keys(n).length,topUser:Object.entries(o).sort(([,e],[,t])=>t-e)[0],topProject:Object.entries(i).sort(([,e],[,t])=>t-e)[0]},charts:{dailyHours:n,userHours:o,projectHours:i}}}async function A(e,t,r,a){let s=await m.budget.findMany({where:{OR:[{startDate:{lte:t},endDate:{gte:e}}],...r?.clientIds?.length&&{clientId:{in:r.clientIds}},...r?.projectIds?.length&&{projectId:{in:r.projectIds}}},include:{project:{select:{id:!0,name:!0}},client:{select:{id:!0,name:!0}}}}),n=await Promise.all(s.map(async e=>{let t=await m.expense.aggregate({where:{date:{gte:e.startDate,lte:e.endDate},...e.projectId&&{projectId:e.projectId},...e.clientId&&{clientId:e.clientId}},_sum:{amount:!0,taxAmount:!0}}),r=(t._sum.amount||0)+(t._sum.taxAmount||0),a=e.totalAmount>0?r/e.totalAmount*100:0,s=e.totalAmount-r,n=Math.max(0,Math.ceil((e.endDate.getTime()-new Date().getTime())/864e5)),o=r>0?r/Math.max(1,Math.ceil((new Date().getTime()-e.startDate.getTime())/864e5)):0,i=o*n,u=Math.max(0,r+i-e.totalAmount);return{id:e.id,name:e.name,project:e.project?.name,client:e.client?.name,totalAmount:e.totalAmount,spent:r,remaining:s,utilization:a,status:a>100?"OVER_BUDGET":a>80?"AT_RISK":"ON_TRACK",daysRemaining:n,dailyBurnRate:o,projectedSpend:i,projectedOverrun:u,categories:e.categories}}));return{budgets:n,summary:{totalBudgets:s.length,totalAllocated:n.reduce((e,t)=>e+t.totalAmount,0),totalSpent:n.reduce((e,t)=>e+t.spent,0),averageUtilization:n.reduce((e,t)=>e+t.utilization,0)/s.length,overBudgetCount:n.filter(e=>"OVER_BUDGET"===e.status).length,atRiskCount:n.filter(e=>"AT_RISK"===e.status).length}}}async function O(e,t,r,a){let s=await m.revenue.findMany({where:{date:{gte:new Date(e.getTime()-31536e6),lte:e},...r?.clientIds?.length&&{clientId:{in:r.clientIds}},...r?.projectIds?.length&&{projectId:{in:r.projectIds}}},include:{client:{select:{id:!0,name:!0}},project:{select:{id:!0,name:!0}}}}),n=await m.revenue.findMany({where:{date:{gte:e,lte:t},...r?.clientIds?.length&&{clientId:{in:r.clientIds}},...r?.projectIds?.length&&{projectId:{in:r.projectIds}}}}),o=_(s,[],new Date(e.getTime()-31536e6),e),i=_(n,[],e,t),u=Object.values(o.revenues||{}),l=u.length>1?(u[u.length-1]-u[0])/(u.length-1):0,c=[],d=Object.values(i.revenues||{})[0]||0;for(let e=1;e<=6;e++){let r=new Date(t);r.setMonth(r.getMonth()+e);let a=Math.max(0,d+l*e);c.push({month:r.toISOString().substring(0,7),projected:a,confidence:Math.max(.3,1-.1*e)})}return{historical:o,current:i,forecast:c,summary:{averageMonthlyGrowth:l,projectedTotal:c.reduce((e,t)=>e+t.projected,0),confidenceLevel:c.reduce((e,t)=>e+t.confidence,0)/c.length}}}async function R(e,t,r,a){let s=await m.expense.findMany({where:{date:{gte:e,lte:t},...r?.userIds?.length&&{userId:{in:r.userIds}},...r?.categories?.length&&{category:{in:r.categories}},...r?.statuses?.length&&{status:{in:r.statuses}}},include:{user:{select:{id:!0,name:!0}},project:{select:{id:!0,name:!0}},client:{select:{id:!0,name:!0}}}}),n=T(s,"category","amount"),o=T(s,"user.name","amount"),i=T(s,"project.name","amount"),u=T(s,"status","amount"),l=_([],s,e,t);return{expenses:s.map(e=>({id:e.id,date:e.date,amount:e.amount+e.taxAmount,category:e.category,description:e.description,user:e.user?.name,project:e.project?.name,client:e.client?.name,status:e.status})),breakdown:{byCategory:n,byUser:o,byProject:i,byStatus:u,byMonth:l.expenses},summary:{totalExpenses:s.reduce((e,t)=>e+t.amount+t.taxAmount,0),totalEntries:s.length,averageExpense:s.length>0?s.reduce((e,t)=>e+t.amount+t.taxAmount,0)/s.length:0,topCategory:Object.entries(n).sort(([,e],[,t])=>t-e)[0],topUser:Object.entries(o).sort(([,e],[,t])=>t-e)[0]}}}async function D(e,t,r,a){let s=await m.task.findMany({where:{createdAt:{gte:e,lte:t},...r?.userIds?.length&&{assigneeId:{in:r.userIds}},...r?.projectIds?.length&&{projectId:{in:r.projectIds}},...r?.statuses?.length&&{status:{in:r.statuses}},...r?.priorities?.length&&{priority:{in:r.priorities}}},include:{assignee:{select:{id:!0,name:!0}},project:{select:{id:!0,name:!0}},timeEntries:{select:{hours:!0}}}}),n=T(s,"status","id"),o=T(s,"priority","id"),i=T(s,"assignee.name","id"),u=T(s,"project.name","id"),l=s.filter(e=>"DONE"===e.status),c=s.filter(e=>e.dueDate&&new Date(e.dueDate)<new Date&&"DONE"!==e.status);return{tasks:s.map(e=>({id:e.id,title:e.title,status:e.status,priority:e.priority,assignedTo:e.assignee?.name,project:e.project?.name,createdAt:e.createdAt,dueDate:e.dueDate,completedAt:e.updatedAt,totalHours:e.timeEntries.reduce((e,t)=>e+t.hours,0),isOverdue:e.dueDate&&new Date(e.dueDate)<new Date&&"DONE"!==e.status})),breakdown:{byStatus:n,byPriority:o,byUser:i,byProject:u},summary:{totalTasks:s.length,completedTasks:l.length,completionRate:s.length>0?l.length/s.length*100:0,overdueTasks:c.length,averageCompletionTime:l.length>0?l.reduce((e,t)=>t.updatedAt&&t.createdAt?e+(new Date(t.updatedAt).getTime()-new Date(t.createdAt).getTime()):e,0)/l.length/864e5:0}}}async function S(e,t,r){return{message:"Custom query execution is not fully implemented in this demo",query:e,data:[]}}function T(e,t,r){return e.reduce((e,a)=>{let s=M(a,t)||"Unknown",n="id"===r?1:M(a,r)||0;return e[s]=(e[s]||0)+n,e},{})}function _(e,t,r,a){let s={},n=new Date(r);for(;n<=a;)s[n.toISOString().substring(0,7)]={revenues:0,expenses:0},n.setMonth(n.getMonth()+1);return e.forEach(e=>{let t=new Date(e.date).toISOString().substring(0,7);s[t]&&(s[t].revenues+=e.amount+e.taxAmount)}),t.forEach(e=>{let t=new Date(e.date).toISOString().substring(0,7);s[t]&&(s[t].expenses+=e.amount+e.taxAmount)}),{revenues:Object.fromEntries(Object.entries(s).map(([e,t])=>[e,t.revenues])),expenses:Object.fromEntries(Object.entries(s).map(([e,t])=>[e,t.expenses])),profit:Object.fromEntries(Object.entries(s).map(([e,t])=>[e,t.revenues-t.expenses]))}}function M(e,t){return t.split(".").reduce((e,t)=>e?.[t],e)}let N=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/reports/custom/route",pathname:"/api/reports/custom",filename:"route",bundlePath:"app/api/reports/custom/route"},resolvedPagePath:"E:\\trae\\izoolyumCRM2.0\\zoolyumCRM2.0\\src\\app\\api\\reports\\custom\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:Y,workUnitAsyncStorage:q,serverHooks:C}=N;function P(){return(0,o.patchFetch)({workAsyncStorage:Y,workUnitAsyncStorage:q})}},27771:()=>{},87859:()=>{},26718:(e,t,r)=>{"use strict";r.d(t,{Nh:()=>c});var a=r(47033),s=r(58196),n=r(34875),o=r(65972),i=r(50826),u=r(96330);let l="true"===process.env.AUTH_BYPASS_ENABLED,c={adapter:(0,a.y)(o.z),session:{strategy:"jwt"},pages:{signIn:"/auth/signin",signUp:"/auth/signup"},providers:[(0,n.A)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,s.A)({name:"credentials",credentials:{email:{label:"Email",type:"email",placeholder:"john@example.com"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;if(l){console.warn("\uD83D\uDEA8 AUTH BYPASS MODE ENABLED - DEVELOPMENT ONLY!");let e=await o.z.user.findFirst({where:{role:u.UserRole.ADMIN,isActive:!0},select:{id:!0,email:!0,name:!0,role:!0,avatar:!0}});return e?{id:e.id,email:e.email,name:e.name,role:e.role,avatar:e.avatar}:{id:"bypass-user",email:"bypass@agency.com",name:"Bypass User (DEV)",role:u.UserRole.ADMIN,avatar:null}}let t=await o.z.user.findUnique({where:{email:e.email},select:{id:!0,email:!0,name:!0,password:!0,role:!0,avatar:!0,isActive:!0}});return t&&t.isActive&&t.password&&await (0,i.compare)(e.password,t.password)?{id:t.id,email:t.email,name:t.name,role:t.role,avatar:t.avatar}:null}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role,e.avatar=t.avatar),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.role=t.role,e.user.avatar=t.avatar),e),async signIn({user:e,account:t,profile:r}){if(t?.provider==="google")try{await o.z.user.findUnique({where:{email:e.email}})||await o.z.user.create({data:{email:e.email,name:e.name,avatar:e.image,role:u.UserRole.AGENT}})}catch(e){return console.error("Error creating user:",e),!1}return!0}}}},65972:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});var a=r(96330);let s=globalThis.prisma??new a.PrismaClient({log:["query"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[5363,3186,7304,4133],()=>r(37325));module.exports=a})();